SHELL=/bin/sh

.SUFFIXES: .fig .pictex .pstex_t .tex .dvi .eps .ps .ps2 .ps2d .ps4 .pdf

TEXCMD=pdflatex
BIBCMD=bibtex
DVIPS=dvips


# main source files
NAME = escience08
TEXTS=$(NAME).tex

#DVIS=draft.dvi bericht.dvi

# the next two Macros are files that are generated by rules, therefore can
# be _removed_ when cleaning
TEXPICTS=


DVIRESULTS=$(NAME).dvi
PSRESULTS=$(NAME).ps
PDFRESULTS=$(NAME).pdf

all: $(PDFRESULTS)
# all: $(DVIRESULTS) # $(PSRESULTS)


dvis: $(DVIS)


$(NAME).pdf: $(TEXTS) literatur.bib

.tex.pdf:
	$(TEXCMD) $<
	-@{ test `grep -c bibstyle $*.aux` != 0 \
		&& echo "$(BIBCMD) $* " && $(BIBCMD) $* ; } || true
	-@while (test `grep -c Rerun $*.log` != 0) ; \
	do \
		echo "$(TEXCMD) $<" ; $(TEXCMD) $< ; \
		{ test `grep -c bibstyle $*.aux` != 0 \
			&& echo "$(BIBCMD) $* " && $(BIBCMD) $* ; } || true ; \
	done
	$(TEXCMD) $< ;
	$(TEXCMD) $< ;

.dvi.ps:
	dvips -t lettersize -o $*.ps $<

.dvi.pdf:
	dvipdf $<

# sigh. for general ps input files, we cannot assume anything about margins
# etc, and thus need to do a ``real'' a4toa5 conversion
.ps.ps2:
	pstops '2:0L@.707(1w,0cm)+1L@.707(1w,0.5h)' $< > $*.ps2

#abgestimmt mit dina4.sty
#.ps.ps2:
#	pstops -h29.7cm '2:0L@0.81(22.5cm,0.0cm)+1L@0.81(22.5cm,0.45h)' \
#		$< > $*.ps2

.dvi.ps2:
	dvips -t letterSize -f -x 707 $< | \
	pstops -h29.7cm '2:0L@1.0(28.8cm,0.0cm)+1L@1.0(28.8cm,0.45h)' \
		> $*.ps2

# as above, but put every second shhet upside down, for doublesided printing
# at LRR-TUM
.dvi.ps2d:
	dvips -f -x 707 $< | \
	pstops -h29.7cm '4:0L@1.0(28.8cm,0.0cm)+1L@1.0(28.8cm,0.45h),2R@1.0(-0.4w,1h)+3R@1.0(-0.4w,0.5h)' \
		> $*.ps2d


# this one should be superfluous
.ps2.ps4:
	pstops -h29.7cm '2:0L@.75(22.3cm,0)+1L@.75(22.3cm,14.85cm)' $< > $*.ps4

# this one actually works correctly as expected :-)
.ps.ps4:
	pstops '4:0@.499(0,.5h)+1@.499(.5w,.5h)+2@.499(0,0)+3@.499(.5w,0)' \
		$< > $*.ps4

.fig.tex:
	fig2dev -Llatex $< $*.tex

.fig.pictex:
	fig2dev -Lpictex $< $*.pictex

.fig.eps:
	fig2dev -Leps $< $*.eps

.fig.pdf:
	fig2dev -Lpdf $< $*.pdf

.fig.pstex_t:
	fig2dev -Lpstex_t -p $*.pstex $< $*.pstex_t
	#fig2dev -Lpstex -p portrait $< $*.pstex
	fig2dev -Lpstex -p portrait $< $*.pstex

clean:
	rm -f *.aux *.dvi *.log *.toc *.blg *.bbl *.pictex *.ps2 *.ps2d \
		.emacs_* *.pstex *.pstex_t *.bak *.stylus *.idx *.ilg *.ind *.backup \
		$(TEXPICTS) $(PSRESULTS) $(PDFRESULTS)

2ps:
	psnup -2 $(NAME).ps > $(NAME)_2.ps
